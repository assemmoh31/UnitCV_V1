<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UnitCV</title>

    <meta name="google-adsense-account" content="ca-pub-2239313494905583">
    <!--
    !!! AD SENSE INTEGRATION POINT 1: GLOBAL CODE !!!
    PASTE YOUR GOOGLE ADSENSE CODE SNIPPET HERE (usually includes your Publisher ID).
    This script is necessary for Google to verify your site and run Auto ads.
    -->
    <!-- START GOOGLE ADSENSE GLOBAL SCRIPT -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2239313494905583"
     crossorigin="anonymous"></script>    <!-- END GOOGLE ADSENSE GLOBAL SCRIPT -->

    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // --- Theme Initializer Script (Runs before page load) ---
        // Changed: Only apply 'dark' class if localStorage explicitly says 'dark'.
        // This ensures the default is light mode, ignoring system preference.
        if (localStorage.theme === 'dark') {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.remove('dark')
        }
        
        tailwind.config = {
            darkMode: 'class', // Enable dark mode based on the 'dark' class on the html element
            theme: {
                extend: {
                    colors: {
                        'primary': '#4f46e5', // Indigo
                        'secondary': '#8b5cf6', // Violet
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Custom styles for a nicer appearance */
        body {
            /* Responsive background: Light in light mode, dark in dark mode */
            background-color: #f3f4f6; /* Light gray background */
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s;
        }
        .dark body {
            background-color: #111827; /* Dark gray background */
        }
        /* Style for the input and select fields */
        .converter-field {
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        /* Focus styles remain similar for both themes but with better contrast */
        .converter-field:focus {
            border-color: #a78bfa; /* Secondary color border on focus */
            box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.5);
        }
        /* Modal backdrop and content animation */
        .modal {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen flex items-start justify-center p-4 flex-col items-center">

    <!-- Removed the external div wrapper for the button -->

    <div id="app" class="w-full max-w-xl bg-white dark:bg-gray-800 shadow-2xl dark:shadow-none rounded-xl p-6 md:p-8">
        
        <!-- New Flex container for Title and Toggle -->
        <div class="flex justify-between items-center mb-2">
            <h1 class="text-3xl font-bold text-primary dark:text-secondary text-left">
                UnitCV
            </h1>
            <!-- Theme Toggle Button moved here, removed external margin classes -->
            <button id="theme-toggle" onclick="toggleTheme()" class="p-2 rounded-full text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition duration-150">
                <!-- Icon will be dynamically updated by JS -->
                <svg id="sun-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="moon-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </div>

        <!-- The introductory paragraph needs an updated margin to fit the new layout -->
        <p class="text-left text-gray-500 dark:text-gray-400 mb-4 mt-2">
            Convert Length, Weight, Temperature, Area, Volume, Time, Speed, Data Storage, Pressure, and Energy units instantly.
        </p>

        <!--
        !!! AD SENSE INTEGRATION POINT 2: AD UNIT SLOT !!!
        This is a container for a responsive banner ad. PASTE YOUR AD UNIT CODE HERE.
        -->
        <div class="my-4 flex justify-center">
            <!-- START GOOGLE ADSENSE AD UNIT CODE -->
            <!-- PASTE YOUR GOOGLE ADSENSE DISPLAY AD UNIT CODE HERE. -->
            <!-- Example:
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2239313494905583"
                 data-ad-slot="YYYYYYYYYY"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            -->
            <!-- END GOOGLE ADSENSE AD UNIT CODE -->
        </div>
        <!-- End Ad Slot -->

        <!-- Category Selector -->
        <div class="mb-6">
            <label for="category-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Conversion Type
            </label>
            <select id="category-select" class="converter-field w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-200 appearance-none">
                <option value="length">Length</option>
                <option value="weight">Weight</option>
                <option value="temperature">Temperature</option>
                <option value="volume">Volume</option>
                <option value="area">Area</option>
                <option value="time">Time</option>
                <option value="speed">Speed</option>
                <option value="data">Data Storage</option>
                <option value="pressure">Pressure</option>
                <option value="energy">Energy</option>
            </select>
        </div>

        <!-- Input and Output Section -->
        <div class="space-y-6">
            <!-- FROM Input -->
            <div class="flex flex-col md:flex-row gap-4 items-center">
                <div class="w-full">
                    <label for="input-value" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Input Value
                    </label>
                    <!-- Removed fixed min="0" to allow dynamic setting based on category -->
                    <input type="number" id="input-value" value="1" step="any"
                           class="converter-field w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-lg font-semibold text-gray-800 dark:text-gray-100 dark:bg-gray-700"
                           placeholder="Enter value" oninput="convert()">
                </div>
                <div class="w-full md:w-1/2">
                    <label for="from-unit" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        From Unit
                    </label>
                    <select id="from-unit" onchange="convert()"
                            class="converter-field w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 appearance-none"></select>
                </div>
            </div>

            <!-- Conversion Arrow Icon -->
            <div class="flex justify-center py-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-secondary dark:text-primary transform rotate-90 md:rotate-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                </svg>
            </div>

            <!-- TO Output -->
            <div class="flex flex-col md:flex-row gap-4 items-center">
                <div class="w-full">
                    <label for="output-value" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Converted Result
                    </label>
                    <input type="text" id="output-value" readonly
                           class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg text-lg font-bold bg-purple-50 dark:bg-purple-900 text-secondary dark:text-purple-300 cursor-not-allowed"
                           placeholder="Result">
                </div>
                <div class="w-full md:w-1/2">
                    <label for="to-unit" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        To Unit
                    </label>
                    <select id="to-unit" onchange="convert()"
                            class="converter-field w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 appearance-none"></select>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer with Privacy Link -->
    <footer class="w-full max-w-xl text-center mt-6 text-sm text-gray-500 dark:text-gray-400 pb-4">
        &copy; 2024 UnitCV.
        <!-- Updated link to open the modal -->
        <button onclick="showModal('privacy-modal')" class="text-primary dark:text-secondary hover:text-secondary dark:hover:text-primary hover:underline ml-2">
            Privacy Policy
        </button>
    </footer>

    <!-- Privacy Policy Modal (Hidden by Default) -->
    <div id="privacy-modal" class="modal fixed inset-0 bg-gray-900 bg-opacity-75 hidden flex items-center justify-center p-4 z-50" onclick="hideModal('privacy-modal')">
        <div class="modal-content bg-white dark:bg-gray-800 w-full max-w-lg rounded-xl shadow-2xl overflow-y-auto max-h-[90vh] p-6" onclick="event.stopPropagation()">
            
            <div class="flex justify-between items-center border-b pb-3 mb-4 border-gray-200 dark:border-gray-700">
                <h2 class="text-2xl font-bold text-primary dark:text-secondary">Privacy Policy</h2>
                <button onclick="hideModal('privacy-modal')" class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 p-2">
                    <!-- Close Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Policy Content Container -->
            <div id="policy-content" class="text-gray-700 dark:text-gray-300 text-sm space-y-4">
                <!-- Content will be injected by JavaScript -->
            </div>
            
        </div>
    </div>

    <script>
        // --- Unit Definitions and Conversion Logic ---

        // Conversion factors are relative to a base unit.
        const KILOBYTE = 1024;
        const MEGABYTE = KILOBYTE * 1024;
        const GIGABYTE = MEGABYTE * 1024;
        const TERABYTE = GIGABYTE * 1024;

        const UNITS = {
            length: {
                // Base Unit: Meter (1)
                meter: { name: "Meter", factor: 1 },
                kilometer: { name: "Kilometer", factor: 1000 },
                centimeter: { name: "Centimeter", factor: 0.01 },
                millimeter: { name: "Millimeter", factor: 0.001 },
                micrometer: { name: "Micrometer", factor: 0.000001 },
                angstrom: { name: "Angstrom", factor: 1e-10 }, 
                mile: { name: "Mile", factor: 1609.34 },
                nauticalMile: { name: "Nautical Mile", factor: 1852 },
                yard: { name: "Yard", factor: 0.9144 },
                foot: { name: "Foot", factor: 0.3048 },
                inch: { name: "Inch", factor: 0.0254 }
            },
            weight: {
                // Base Unit: Kilogram (1)
                kilogram: { name: "Kilogram", factor: 1 }, 
                gram: { name: "Gram", factor: 0.001 },
                milligram: { name: "Milligram", factor: 0.000001 },
                carat: { name: "Carat (ct)", factor: 0.0002 }, 
                tonne: { name: "Tonne (Metric Ton)", factor: 1000 },
                usTon: { name: "US Ton (Short)", factor: 907.185 }, 
                pound: { name: "Pound (lb)", factor: 0.453592 },
                ounce: { name: "Ounce (oz)", factor: 0.0283495 }
            },
            volume: {
                // Base Unit: Liter (1)
                liter: { name: "Liter", factor: 1 }, 
                milliliter: { name: "Milliliter", factor: 0.001 },
                cubicCentimeter: { name: "Cubic Centimeter", factor: 0.001 },
                cubicMeter: { name: "Cubic Meter", factor: 1000 },
                usGallon: { name: "US Gallon", factor: 3.78541 },
                imperialGallon: { name: "Imperial Gallon", factor: 4.54609 },
                usBarrel: { name: "US Barrel (Liquid)", factor: 119.24 }, 
                fluidOunce: { name: "Fluid Ounce (US)", factor: 0.0295735 }
            },
            area: {
                // Base Unit: Square Meter (1)
                squareMeter: { name: "Square Meter", factor: 1 }, 
                squareKilometer: { name: "Square Kilometer", factor: 1000000 },
                squareCentimeter: { name: "Square Centimeter", factor: 0.0001 },
                squareFoot: { name: "Square Foot", factor: 0.092903 },
                squareYard: { name: "Square Yard", factor: 0.836127 },
                acre: { name: "Acre", factor: 4046.86 },
                hectare: { name: "Hectare", factor: 10000 },
                squareMile: { name: "Square Mile", factor: 2589988.11 }
            },
            // Temperature is special and requires functions, not just factors. Base is Celsius
            temperature: {
                celsius: { name: "Celsius (°C)", toBase: (c) => c, fromBase: (c) => c }, 
                fahrenheit: { name: "Fahrenheit (°F)", toBase: (f) => (f - 32) * 5 / 9, fromBase: (c) => (c * 9 / 5) + 32 },
                kelvin: { name: "Kelvin (K)", toBase: (k) => k - 273.15, fromBase: (c) => c + 273.15 },
                rankine: { 
                    name: "Rankine (°R)", 
                    toBase: (r) => (r - 491.67) * 5 / 9, 
                    fromBase: (c) => (c * 9 / 5) + 491.67 
                }
            },
            time: {
                // Base Unit: Second (1)
                second: { name: "Second (s)", factor: 1 },
                millisecond: { name: "Millisecond (ms)", factor: 0.001 },
                microsecond: { name: "Microsecond", factor: 1e-6 },
                minute: { name: "Minute (min)", factor: 60 },
                hour: { name: "Hour (hr)", factor: 3600 },
                day: { name: "Day (d)", factor: 86400 },
                week: { name: "Week", factor: 604800 },
                year: { name: "Year (365d)", factor: 31536000 }
            },
            speed: {
                // Base Unit: Meter per Second (1)
                meterPerSecond: { name: "Meters per Second", factor: 1 },
                kilometerPerHour: { name: "Kilometers per Hour", factor: 1 / 3.6 }, 
                milesPerHour: { name: "Miles per Hour", factor: 0.44704 }, 
                footPerSecond: { name: "Feet per Second", factor: 0.3048 },
                knot: { name: "Knot (Nautical mph)", factor: 0.514444 }, 
                mach: { name: "Mach (sea level, approx)", factor: 343 }, 
            },
            data: {
                // Base Unit: Byte (1) - Uses binary prefixes (powers of 1024)
                byte: { name: "Byte (B)", factor: 1 },
                kilobyte: { name: "Kilobyte (KB)", factor: KILOBYTE },
                megabyte: { name: "Megabyte (MB)", factor: MEGABYTE },
                gigabyte: { name: "Gigabyte (GB)", factor: GIGABYTE },
                terabyte: { name: "Terabyte (TB)", factor: TERABYTE },
                bit: { name: "Bit (b)", factor: 1/8 }, 
            },
            // --- CATEGORY: PRESSURE ---
            pressure: {
                // Base Unit: Pascal (Pa)
                pascal: { name: "Pascal (Pa)", factor: 1 },
                kilopascal: { name: "Kilopascal (kPa)", factor: 1000 },
                bar: { name: "Bar", factor: 100000 },
                atmosphere: { name: "Atmosphere (atm)", factor: 101325 },
                psi: { name: "Pound/Square Inch (psi)", factor: 6894.76 },
                torr: { name: "Torr (mmHg)", factor: 133.322 },
                millibar: { name: "Millibar (mbar)", factor: 100 }
            },
            // --- CATEGORY: ENERGY ---
            energy: {
                // Base Unit: Joule (J)
                joule: { name: "Joule (J)", factor: 1 },
                kilojoule: { name: "Kilojoule (kJ)", factor: 1000 },
                calorie: { name: "Calorie (cal)", factor: 4.184 }, // Small calorie
                kilocalorie: { name: "Kilocalorie (kcal/Cal)", factor: 4184 }, // Food calorie
                wattHour: { name: "Watt-hour (Wh)", factor: 3600 },
                kilowattHour: { name: "Kilowatt-hour (kWh)", factor: 3600000 },
                electronvolt: { name: "Electronvolt (eV)", factor: 1.602176634e-19 },
                britishThermalUnit: { name: "BTU (IT)", factor: 1055.06 }
            }
        };

        // --- DOM Elements ---
        const categorySelect = document.getElementById('category-select');
        const fromUnitSelect = document.getElementById('from-unit');
        const toUnitSelect = document.getElementById('to-unit');
        const inputValue = document.getElementById('input-value');
        const outputValue = document.getElementById('output-value');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');

        // --- Theme Toggle Logic ---
        /**
         * Toggles the light/dark theme, updates localStorage, and switches the button icon.
         */
        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcon(isDark);
        }

        /**
         * Updates the visibility of the sun and moon icons based on the current theme.
         * @param {boolean} isDark - True if dark mode is active.
         */
        function updateThemeIcon(isDark) {
            if (isDark) {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        }

        // --- Privacy Policy Content (Embedded HTML) ---
        const PRIVACY_POLICY_HTML = `
            <h2 class="text-xl font-bold mb-3">Privacy Policy for UnitCV</h2>
            <p class="text-xs text-gray-500 mb-6 font-mono">Last Updated: November 22, 2025</p>

            <p class="mb-4">The UnitCV application ("the App") is designed to provide quick and accurate unit conversions without tracking or storing any personal data.</p>

            <h3 class="text-lg font-semibold mt-4 mb-2 text-primary dark:text-secondary">1. Information We Do Not Collect</h3>
            <p class="mb-4">The App is a static, client-side application running entirely in your browser. We do not collect, store, or transmit any personal information, usage data, or conversion history.</p>
            <p class="mb-2 font-medium">Specifically, we do not collect:</p>
            <ul class="list-disc list-inside ml-4 space-y-1 text-gray-700 dark:text-gray-300">
                <li>Names, email addresses, or contact details.</li>
                <li>IP addresses or location data.</li>
                <li>Information entered into the conversion fields (input values or unit selections).</li>
            </ul>

            <h3 class="text-lg font-semibold mt-4 mb-2 text-primary dark:text-secondary">2. Third-Party Services & Advertising</h3>
            <p class="mb-4">This application uses the following third-party services:</p>
            <ul class="list-disc list-inside ml-4 space-y-1 text-gray-700 dark:text-gray-300">
                <li><strong>Tailwind CSS:</strong> Used for styling and layout. This is a library loaded from a CDN and does not track user data.</li>
                <li><strong>Google AdSense:</strong> This service is used to display advertisements and may use cookies, web beacons, and other tracking technologies to serve ads based on users' prior visits to this and other websites. These ads are served by Google and its partners.</li>
            </ul>
            <p class="mt-4 mb-4">You can opt out of personalized advertising by visiting <a href="http://www.aboutads.info/choices/" target="_blank" class="text-primary dark:text-secondary hover:underline">About Ads</a> or by adjusting your Google Ad Settings.</p>

            <h3 class="text-lg font-semibold mt-4 mb-2 text-primary dark:text-secondary">3. Data Storage</h3>
            <p class="mb-4">All data storage and calculations are performed locally within your browser's memory and are not persistent or accessible by us.</p>

            <h3 class="text-lg font-semibold mt-4 mb-2 text-primary dark:text-secondary">4. Changes to This Policy</h3>
            <p class="mb-4">We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page.</p>

            <h3 class="text-lg font-semibold mt-4 mb-2 text-primary dark:text-secondary">5. Contact Us</h3>
            <p class="mb-4">If you have any questions about this Privacy Policy, please contact the developer.</p>
        `;


        // --- Modal Control Functions ---
        
        /**
         * Shows a modal by setting its display style and injecting content.
         * @param {string} id The ID of the modal element.
         */
        function showModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                // Inject content for the policy modal, ensuring dark mode classes are applied
                if (id === 'privacy-modal') {
                    document.getElementById('policy-content').innerHTML = PRIVACY_POLICY_HTML;
                }
                
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.style.opacity = '1';
                    modal.querySelector('.modal-content').style.transform = 'translateY(0)';
                }, 10); // Small delay to trigger transition
            }
        }
        
        /**
         * Hides a modal.
         * @param {string} id The ID of the modal element.
         */
        function hideModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.style.opacity = '0';
                modal.querySelector('.modal-content').style.transform = 'translateY(20px)';
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300); // Wait for transition to complete before hiding
            }
        }


        /**
         * Populates the unit dropdowns based on the selected category and sets input restrictions.
         */
        function populateUnits() {
            const category = categorySelect.value;
            const units = UNITS[category];
            
            // Clear existing options
            fromUnitSelect.innerHTML = '';
            toUnitSelect.innerHTML = '';

            // Populate both dropdowns with the new unit options
            for (const key in units) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = units[key].name;
                
                // Clone the option for the "To Unit" select
                fromUnitSelect.appendChild(option);
                toUnitSelect.appendChild(option.cloneNode(true));
            }

            // Set default selections for a smoother start based on category
            let defaultFrom, defaultTo;
            switch(category) {
                case 'length':
                    defaultFrom = 'meter';
                    defaultTo = 'centimeter'; // Changed default to cm for better mobile visibility
                    break;
                case 'weight':
                    defaultFrom = 'kilogram';
                    defaultTo = 'gram';
                    break;
                case 'volume':
                    defaultFrom = 'liter';
                    defaultTo = 'milliliter';
                    break;
                case 'area':
                    defaultFrom = 'squareMeter';
                    defaultTo = 'acre';
                    break;
                case 'temperature':
                    defaultFrom = 'celsius';
                    defaultTo = 'fahrenheit';
                    break;
                case 'time': 
                    defaultFrom = 'second';
                    defaultTo = 'minute';
                    break;
                case 'speed': 
                    defaultFrom = 'meterPerSecond';
                    defaultTo = 'milesPerHour';
                    break;
                case 'data': 
                    defaultFrom = 'byte';
                    defaultTo = 'kilobyte';
                    break;
                case 'pressure': 
                    defaultFrom = 'pascal';
                    defaultTo = 'bar';
                    break;
                case 'energy': 
                    defaultFrom = 'joule';
                    defaultTo = 'kilocalorie';
                    break;
                default:
                    // Fallback to the first two units if category is unknown
                    const keys = Object.keys(units);
                    defaultFrom = keys[0];
                    defaultTo = keys[1] || defaultFrom;
            }
            
            fromUnitSelect.value = defaultFrom;
            toUnitSelect.value = defaultTo;
            
            // --- Mobile UX Improvement: Dynamic Input Restrictions ---
            if (category === 'temperature') {
                // Allow negative values for temperature
                inputValue.removeAttribute('min');
                inputValue.placeholder = "e.g., -10 or 25";
            } else {
                // Restrict to non-negative values for all others
                inputValue.setAttribute('min', '0');
                inputValue.placeholder = "Enter value (must be ≥ 0)";
            }

            // Resetting input value to 1 if it's currently negative and shouldn't be
            if (category !== 'temperature' && parseFloat(inputValue.value) < 0) {
                inputValue.value = 1;
            }

            // Run conversion immediately after populating
            convert();
        }

        /**
         * Performs the unit conversion based on the selected category, units, and input value.
         */
        function convert() {
            const category = categorySelect.value;
            const units = UNITS[category];
            const fromUnitKey = fromUnitSelect.value;
            const toUnitKey = toUnitSelect.value;
            const value = parseFloat(inputValue.value);
            
            // Validate input
            if (isNaN(value)) {
                outputValue.value = "Invalid Input";
                return;
            }
            
            // Enforce non-negative for non-temperature categories (in case user bypasses HTML 'min')
            if (category !== 'temperature' && value < 0) {
                outputValue.value = "Value must be non-negative";
                return;
            }

            if (fromUnitKey === toUnitKey) {
                 // Use parseFloat(toFixed(4)) to ensure consistency and remove unnecessary trailing zeros
                 outputValue.value = parseFloat(value.toFixed(4)); 
                 return;
            }
            
            let result;

            if (category === 'temperature') {
                // Temperature uses special formulas (toBase/fromBase functions)
                const fromUnit = units[fromUnitKey];
                const toUnit = units[toUnitKey];
                
                // 1. Convert "From" value to the base unit (Celsius)
                const baseValue = fromUnit.toBase(value);

                // 2. Convert from the base unit (Celsius) to the "To" unit
                result = toUnit.fromBase(baseValue);

            } else {
                // All other categories use factor-based conversions
                const fromFactor = units[fromUnitKey].factor;
                const toFactor = units[toUnitKey].factor;
                
                // 1. Convert "From" value to the base unit (Value * Factor)
                const baseValue = value * fromFactor;
                
                // 2. Convert from the base unit to the "To" unit (BaseValue / ToFactor)
                result = baseValue / toFactor;
            }

            // Adjust decimal places for display depending on the magnitude or category
            let fixedDecimals = 4;
            if (category === 'data' && result > 1000) {
                fixedDecimals = 2;
            } else if (category === 'energy' && toUnitKey === 'electronvolt') {
                fixedDecimals = 0; // Use 0 for extremely large/small factors like eV
            }
            
            // Apply toFixed for precision, then use parseFloat to remove unnecessary trailing zeros
            outputValue.value = parseFloat(result.toFixed(fixedDecimals));
        }

        // --- Event Listeners and Initialization ---

        // Listen for category changes
        categorySelect.addEventListener('change', populateUnits);

        // Listen for input and unit changes
        inputValue.addEventListener('input', convert);
        fromUnitSelect.addEventListener('change', convert);
        toUnitSelect.addEventListener('change', convert);

        // Initialize the app when the window loads
        window.onload = () => {
            populateUnits();
            // Check initial theme and set icon once the DOM elements are ready
            updateThemeIcon(document.documentElement.classList.contains('dark'));
        };
        
    </script>
</body>
</html>


